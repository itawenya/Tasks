# é˜¶æ®µå…­çˆ¬è™«æ—¥å¿—



### å¼€å§‹ï¼Œä¸ºäº†ä½“éªŒçˆ¬å–ç½‘é¡µè§†é¢‘æˆ‘å…ˆç²—ç•¥åœ°

### ä»¿ç…§æ•™ç¨‹è¯•äº†ä¸€ä¸‹çˆ¬å–å¾®åšçš„è§†é¢‘ï¼š



[è¿™æ˜¯è§†é¢‘åŸå§‹ç½‘å€](https://weibo.com/tv/show/1034:4725864357888081?mid=4725866133196408)  æ­¤æ—¶çš„methodä¸ºGet.



![å¾®åšä¾‹å­1.png](https://github.com/itawenya/Tasks/blob/main/%E6%96%B0/%E5%BE%AE%E5%8D%9A%E4%BE%8B%E5%AD%901.png?raw=true)

åœ¨Chormä¸­æ‰“å¼€ å¼€å‘è€…æ¨¡å¼ä¸­networkçš„media

é€‰å–Request Urlç½‘å€ä¸­çš„ä¸€å°æ®µå¹¶åœ¨å·¦ä¾§æœç´¢æ¡†ä¸­æœç´¢

![å¾®åšä¾‹å­2.png](https://github.com/itawenya/Tasks/blob/main/%E6%96%B0/%E5%BE%AE%E5%8D%9A%E4%BE%8B%E5%AD%902.png?raw=true)





é€‰ä¸­ç¬¬ä¸€é¡¹ä¸­æœ‰componentçš„å†…å®¹

åœ¨è¿™é‡Œæ˜¾ç¤ºçš„Request Urlç½‘å€å³[æ’­æ”¾è§†é¢‘çš„ç½‘å€](https://weibo.com/ajax/changekey)  æ­¤æ—¶çš„methodä¸ºPost



![å¾®åšä¾‹å­3.png](https://github.com/itawenya/Tasks/blob/main/%E6%96%B0/%E5%BE%AE%E5%8D%9A%E4%BE%8B%E5%AD%903.png?raw=true)



åœ¨previewä¸­å¯ä»¥çœ‹åˆ°è§†é¢‘é“¾æ¥æŒ‰ç…§ä¸€ä¸‹å±‚çº§é¡ºåºåŒ…å«ï¼š

```
['data']['Component_Play_Playinfo']['urls']['é«˜æ¸… 1080P']
```



![å¾®åšä¾‹å­4.png](https://github.com/itawenya/Tasks/blob/main/%E6%96%B0/%E5%BE%AE%E5%8D%9A%E4%BE%8B%E5%AD%904.png?raw=true)



æ¥ç€æˆ‘ä»¬éœ€è¦æœç´¢ä¸€äº›å¿…è¦å‚æ•°ç”¨ä»¥ä¼ªè£…

æ¯”å¦‚ï¼šcookieï¼Œrefererï¼Œuser-agentå’Œdata



cookieï¼Œrefererï¼Œuser-agentå¯ä»¥åœ¨åˆå§‹ç½‘å€æ‰¾åˆ°



**æˆ‘ä»¬éœ€è¦åœ¨ã€æ’­æ”¾è§†é¢‘çš„ç½‘å€ã€‘çš„playloadé‡Œæ‰¾åˆ°dataï¼Œä½†è®©æˆ‘ä¸è§£çš„æ˜¯åŒæ ·çš„æ–¹æ³•æœ‰çš„è§†é¢‘æˆ‘å´æ‰¾ä¸åˆ°data**

![å¾®åšä¾‹å­6.png](https://github.com/itawenya/Tasks/blob/main/%E6%96%B0/%E5%BE%AE%E5%8D%9A%E4%BE%8B%E5%AD%906.png?raw=true)





é™„ä¸Šæˆ‘ä½“éªŒçˆ¬å–å¾®åšè§†é¢‘çš„æºç ï¼š

```
import requests
url = 'https://weibo.com/tv/api/component?page=%2Ftv%2Fshow%2F1034%3A4725864357888081'
data = {'data': '{"Component_Play_Playinfo":{"oid":"1034:4725864357888081"}}'}
headers = {
    'cookie': 'SUB=_2AkMWuJ0Gf8NxqwJRmP0dz2rjZY5yygjEieKg5GzdJRMxHRl-yT9jqmoItRB6PTiz6YRoPNuQmhnFjCsRR3eR7yuHqwKD; SUBP=0033WrSXqPxfM72-Ws9jqgMF55529P9D9WFpzJ55kj15F0Txa3TCNWE.; SINAGLOBAL=3400756052629.177.1642336817708; TC-V-WEIBO-G0=b09171a17b2b5a470c42e2f713edace0; _s_tentry=-; Apache=9992151456252.889.1642641806570; ULV=1642641806648:3:3:3:9992151456252.889.1642641806570:1642488693713; XSRF-TOKEN=fI_JWAxlLT4TaBSe9lVP_Lqf; WBPSESS=a_YZA6I5qCR3U8i3Rfvlpp4O4vRhTMjBcq8WcoQvWqSOLzgAqPD_v48xdKHPDw2gtPIZhqAoMa314yTQfllHxTc0qWssWIiWQ6WMZS8yv2EYae1hx2MpXxGJb5m4q4tt5swZWQ1i0PJO89JXmK_57EAKnS3QD_pEHzrIxYlVr_I=',
    'referer': 'https://weibo.com/tv/show/1034:4725864357888081?mid=4725866133196408',
    'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/97.0.4692.71 Safari/537.36'
}


json_data = requests.post(url=url,data=data,headers=headers).json()
video_url = 'https:' + json_data['data']['Component_Play_Playinfo']['urls']['é«˜æ¸… 1080P']
video_data = requests.get(video_url).content
with open('video\\1.MP4','wb')as f:
    f.write(video_data)
print('è§†é¢‘çˆ¬å–å¥½å•¦ï¼')
```

æˆåŠŸï¼



#### ä¸€å¼€å§‹çš„å°è¯•è®©æˆ‘ä½“éªŒåˆ°äº†çˆ¬è™«çš„ä¹è¶£ï¼Œä½†è¿˜æ²¡æœ‰å­¦ä¹ å…·ä½“çš„çŸ¥è¯†

#### æ¥ä¸‹æ¥æˆ‘è·Ÿç€è§†é¢‘æ•™ç¨‹å¯¹çˆ¬è™«æŠ€æœ¯è¿›è¡Œäº†å­¦ä¹ ã€‚







### æˆ‘å­¦ä¹ çš„è§†é¢‘çš„ä¾‹å­æ˜¯çˆ¬å–è±†ç“£TOP250çš„ä¿¡æ¯ï¼Œä¸ºäº†ç®€åŒ–

### æˆ‘å†³å®šåªå–ç¬¬ä¸€é¡µï¼Œçœå»äº†ç¿»é¡µçš„å¾ªç¯



è¿™é‡Œé™„ä¸Šç¬”è®°é“¾æ¥ğŸ”—ï¼š[Tasks/çˆ¬è™«å­¦ä¹ ç¬”è®°.md at main Â· itawenya/Tasks (github.com)](https://github.com/itawenya/Tasks/blob/main/æ–°/çˆ¬è™«å­¦ä¹ ç¬”è®°.md)



### è±†ç“£é¡¹ç›®å®æ“èµ·æ¥å¥½åƒæ²¡é—®é¢˜ï¼Œä½†å½“æˆ‘æŠŠurlæ”¹æˆæˆ‘ä»¬[Geekçš„ç½‘å€](http://212.129.245.115/geek)æ—¶

### å´å‡ºç°äº†é—®é¢˜:

å½“æˆ‘è¯•ç€è¾“å‡ºç½‘é¡µçš„æºä»£ç æ—¶

whileè±†ç“£ç½‘å€èƒ½è¾“å‡ºå®Œæ•´çš„ä»£ç 

![å‘ç°é—®é¢˜1.png](https://github.com/itawenya/Tasks/blob/main/%E6%96%B0/%E5%8F%91%E7%8E%B0%E9%97%AE%E9%A2%981.png?raw=true)





è€ŒGeekç½‘å€å´åªèƒ½è¾“å‡ºéƒ¨åˆ†çš„ä»£ç 

![å‘ç°é—®é¢˜2.png](https://github.com/itawenya/Tasks/blob/main/%E6%96%B0/%E5%8F%91%E7%8E%B0%E9%97%AE%E9%A2%982.png?raw=true)





é™„ä¸Šæ­¤æ—¶çš„æºç ï¼š

```python
import urllib.request
import bs4
url = "https://movie.douban.com/top250?start="
#url = "http://212.129.245.115/geek"

def askURL(url): #æ¨¡æ‹Ÿæµè§ˆå™¨å¤´éƒ¨ä¿¡æ¯ï¼Œè¿›è¡Œä¼ªè£…
    head = {'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/97.0.4692.71 Safari/537.36'}
    request = urllib.request.Request(url, headers=head)
    html = ""
    try:
        response = urllib.request.urlopen(request)
        html = response.read().decode('utf-8')
        print(html)
    except urllib.error.URLError as e:
        if hasattr(e, 'code'):
            print(e.code)
        if hasattr(e, 'reason'):
            print(e.reason)
    return html

askURL(url)
```



### çœ‹èµ·æ¥å°±åƒæ˜¯è¾“å‡ºçš„ç»“æœè¢«æŠ˜å èµ·æ¥äº†

### ä½†èµ·åˆæˆ‘æ²¡æœ‰åœ¨æ„







### ä½†å½“æˆ‘å­¦äº†Reåº“å’Œæ­£åˆ™è¡¨è¾¾å¼åæƒ³è¾“å‡ºGeekç½‘å€çš„

### bodyå†…å®¹æ—¶æ‰æ„è¯†åˆ°é—®é¢˜



è¿™æ˜¯è±†ç“£çš„ï¼š

![å‘ç°é—®é¢˜3.png](https://github.com/itawenya/Tasks/blob/main/%E6%96%B0/%E5%8F%91%E7%8E%B0%E9%97%AE%E9%A2%983.png?raw=true)



è¿™æ˜¯Geekçš„ï¼šåªæœ‰ç»†é•¿çš„ä¸€æ¡

![å‘ç°é—®é¢˜4.png](https://github.com/itawenya/Tasks/blob/main/%E6%96%B0/%E5%8F%91%E7%8E%B0%E9%97%AE%E9%A2%984.png?raw=true)





### ä¸ºäº†æŸ¥æ‰¾åŸå› ï¼Œæˆ‘åšäº†ä»¥ä¸‹å°è¯•

#### 1.æˆ‘é¦–å…ˆå°è¯•äº†å‡ ä¸ªä¸åŒçš„ç½‘å€å¹¶è¿è¡Œï¼Œ

#### å‘ç°éƒ½å¯ä»¥åƒè±†ç“£ä¸€æ ·å±•ç¤º  

####  â†’ è¯æ˜æˆ‘çš„ä»£ç å¯è¡Œ





#### 2.æ¥ç€æˆ‘æŸ¥çœ‹æ¯ä¸ªå¯¹åº”ç½‘å€çš„å¼€å‘è€…å·¥å…·æˆ‘

#### å‘ç°æ­¤æ—¶è¾“å‡ºçš„å†…å®¹æ­£æ˜¯Responseä¸­çš„å†…å®¹

#### è€ŒGeekç½‘å€çš„æœ¬èº«å°±æ˜¯æ²¡æœ‰å±•å¼€  

#### â†’ å‘ç°æ½œåœ¨åŸå› 





### æˆ‘å¾—å‡ºä»¥ä¸‹çŒœæƒ³ï¼šï¼ˆå½“ç„¶å•Šä¸ä¸€å®šå¯¹ï¼‰
#### 1.ä¹Ÿè®¸ä¸ç½‘å€çš„åçˆ¬æœºåˆ¶æœ‰å…³



#### 2.ä¹Ÿè®¸ä¸JavaScriptï¼ŒCSSé“¾æ¥æœ‰å…³





### æˆ‘æœ‰äº›å—æŒ«ï¼Œå‰è¾¹å­¦ä¹ äº†è§£æŠ€æœ¯çš„æ—¶é—´è²Œä¼¼æœ‰äº›é•¿äº†

### æˆ‘ç•™ç»™æ“ä½œGeekç½‘å€çš„æ—¶é—´ä¸å¤šäº†

ï¼ˆæˆ‘ä»¥ä¸ºåªæ˜¯æ”¹å˜ç½‘å€çš„åŒºåˆ«è€Œå·²ï¼‰





#### ä½†æˆ‘å‘ç°Geekå›¾ç‰‡çš„ç½‘å€éƒ½æ¥æºä¸ä¸€ä¸ªåœ°æ–¹

â†’https://gitee.com/gritandsea/picture/tree/master/img

#### ä¹Ÿè®¸æˆ‘å¯ä»¥è¯•ç€çˆ¬å–è¿™ä¸ªç½‘å€çš„å›¾ç‰‡ï¼Ÿ

è¿™é‡Œé™„ä¸Šæºç ï¼š

```
import re
import urllib.request
import bs4
url = 'https://gitee.com/gritandsea/picture/tree/master/img'

def main():
    data = getData(url)
    askURL(url)

# findlink = re.compile(r'<a title=(.*>?)>')  ã€è¿™æ˜¯ä¸€ä¸ªå¤±è´¥çš„å°è¯•ã€‘
findlink = re.compile(r'<a href="(.*?)">')   ã€æˆ‘è¯•ç€æŠŠaæ ‡ç­¾å¸¦é“¾æ¥çš„è¾“å‡ºã€‘

def getData(url): #çˆ¬å–ç½‘å€
    data = []
    html = askURL(url)
    soup = bs4.BeautifulSoup(html, "html.parser")
    for item in soup.find_all('a'):
    	item = str(item)
        link = re.findall(findlink,item)
        print(link)
        data.append(link)
        c = str(data)
    
    print(data)
    with open('img\\pic-link.text', 'w')as f:
        f.write(c)

    print('å†™å®Œäº†')
    return data
    

def askURL(url): #æ¨¡æ‹Ÿæµè§ˆå™¨å¤´éƒ¨ä¿¡æ¯ï¼Œè¿›è¡Œä¼ªè£…
    head = {'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/97.0.4692.71 Safari/537.36'}
    request = urllib.request.Request(url, headers=head)
    html = ""
    try:
        response = urllib.request.urlopen(request)
        html = response.read().decode('utf-8')
        #print(html)
    except urllib.error.URLError as e:
        if hasattr(e, 'code'):
            print(e.code)
        if hasattr(e, 'reason'):
            print(e.reason)
    return html

def saveData(savepath):  #ä¿å­˜æ•°æ®
    print('save....')

if __name__ == "__main__":
    main()
```



æ„Ÿè§‰æ˜¯æ­£åˆ™æå–æ³•æˆ–è€…å“ªä¸ªæ²¡æœ‰æ£€æŸ¥å‡º

çš„é—®é¢˜çš„åŸå› ï¼Œå¯ä»¥çœ‹åˆ°è¾“å‡ºç»“æœå·®å¼ºäººæ„ï¼šè™½ç„¶éƒ½åŒ…å«äº†å›¾ç‰‡é“¾æ¥ä½†è¿˜æœ‰å¾ˆå¤šæ‚é¡¹



![è¾“å‡ºæ•ˆæœ.png](https://github.com/itawenya/Tasks/blob/main/%E6%96%B0/%E8%BE%93%E5%87%BA%E6%95%88%E6%9E%9C.png?raw=true)





### æ—¶é—´ä¸å¤Ÿäº†ï¼Œè€å®è¯´é˜¶æ®µå…­ä»»åŠ¡æ²¡æœ‰å¾ˆå¥½åœ°å®Œæˆ

### è¿™æ®µæ—¶é—´çš„å­¦ä¹ è®©æˆ‘å­¦åˆ°

+ ä¸åŒé˜¶æ®µçš„å­¦ä¹ å†…å®¹ç´§å¯†è”ç³»ï¼Œ
+ ä¸€å®šè¦å¤šå°è¯•æ•²ä»£ç ï¼Œä¸è¦åªçœ‹æ•™ç¨‹
+ å³ä½¿çœ‹ä»£ç èƒ½è¯»ä¸ªå¤§æ¦‚ï¼Œä¾‹å­ä¹ŸåŸºæœ¬èƒ½å®Œæˆä¹Ÿä¸€å®šè¦è‡ªå·±å¤šå¤šå°è¯•

+ æœ¬æ¬¡çˆ¬è™«ä»»åŠ¡ä¸ä»…éœ€è¦æ¸…æ™°çš„ä»£ç é€»è¾‘ï¼Œç¬¬ä¸€æ¬¡å†™é•¿é€»è¾‘é“¾çš„ä»£ç æœ‰ç‚¹

â€‹       ä¸ç†Ÿç»ƒ



### ä½“éªŒè¿‡åæˆ‘è®¤ä¸ºçˆ¬è™«é‡ç‚¹æ˜¯åœ¨ç»“åˆHTMLçš„å‰ç«¯çŸ¥è¯†ï¼Œåˆ©ç”¨æ­£åˆ™æ³•åˆ¶å’Œbeautifulsoup

### é“æ±¤æ¥å‡†ç¡®æŸ¥æ‰¾æ‰€éœ€çš„å†…å®¹çš„æ¡ä»¶ã€‚ è¿˜éœ€è¦ç»§ç»­å­¦ä¹ å•Šï¼ï¼ï¼

 



â€‹                                                                                                                                                   ----wy
